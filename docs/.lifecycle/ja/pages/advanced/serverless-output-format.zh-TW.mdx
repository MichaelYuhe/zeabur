---
title: サーバーレス出力フォーマット
ogImageTitle: サーバーレス出力フォーマット
ogImageSubtitle: Zeaburでのサーバーレス形式でのデプロイ
---

import { Callout } from 'nextra-theme-docs'

# サーバーレス出力フォーマット

Zeaburはコンテナ化(Containerized)とサーバーレスの2つのデプロイ方法をサポートしています。プロジェクトのコードをZeaburにデプロイすると、Zeaburは [zbpack](https://github.com/zeabur/zbpack) を使用して自動的に分析および構築を行います。関連するプロセスの説明は[ビルドの原理](./builds)で見つけることができます。

コンテナ化されたデプロイ方法では、計算リソースを多く消費します。なぜなら、サービスが使用されていなくても、サービスの内部状態を維持するために常に開いた状態である必要があるためです。一方、サーバーレスのデプロイ方法は、サービスを複数の即時使用可能なサーバーレス関数に分解し、サービスが外部リクエストを受け取ると、関数を実行して結果を計算および返すため、より高い拡張性を提供し、不要なコストを節約します。

## ビルド出力フォーマット

追加の設定がない場合、zbpackはプロジェクトで使用されている開発フレームワークに基づいてサーバーレスの方法を選択します。zbpackがサーバーレスの方法を選択した場合、ビルドが完了すると、プロジェクトディレクトリの `.zeabur/output`ディレクトリで次の構造を見つけることができます：

```
.zeabur/output
├── static
│   ├── index.html
│   └── ...
├── functions
│   ├── index.func
│   └── ...
```

`static`ディレクトリにはHTML、CSS、JavaScriptなどの静的リソースが格納されており、`functions`ディレクトリにはサーバーレス関数が格納されています。 `.func`で終わる各ディレクトリは関数のエントリであり、デプロイ後のパスに対応しています。例：

- `functions/index.func` の対応するパスは `/`
- `functions/users/get.func` の対応するパスは `/users/get`
- `functions/api/orders.func` の対応するパスは `/api/orders`
- `functions/api/orders/[id].func` の対応するパスは `/api/orders/[id]`であり、`[id]`は動的なパスであり、任意のパスに一致します。

構築物の互換性を最大限に確保するために、zbpackのサーバーレスビルド出力形式は可能な限り [Vercel](https://vercel.com/)の [ビルド出力API(v3)](https://vercel.com/docs/build-output-api/v3) と一致するようになっています。これにより、既存のフレームワークや将来の新しいフレームワークの作者やチームは、各異なるプラットフォーム用のアダプタ（Adapter）を再開発する必要がありません。

## 純粋な静的出力

Viteなどの純粋な静的ウェブフレームワークの場合、zbpackで構築された`.zeabur/output`ディレクトリには `static`ディレクトリしかなく、`functions`ディレクトリはありません。これは純粋な静的ウェブフレームワークはサーバーレス方式でデプロイする必要がないためであり、そのためzbpackはすべての静的リソースを`static`ディレクトリにパッケージ化し、デプロイ時には`static`ディレクトリのリソースを直接CDNにデプロイします。

## サーバーレス関数

Next.jsやNuxt.jsなどのサーバーレスを必要とするフレームワークの場合、zbpackで構築された`.zeabur/output`ディレクトリには `static`および`functions`の2つのディレクトリがあります。 `static`ディレクトリには静的リソースが格納されており、`functions`ディレクトリにはサーバーレス関数が格納されています。

<Callout>
    現在、サーバーレス関数のデプロイはベータ段階です。サーバーレス方式でサービスをデプロイしたい場合は、ビルド時に`EXPERIMENTAL_SERVERLESS=1`の環境変数を追加する必要があります。

    もしあなたのプロジェクトやフレームワークがサーバーレス関数方式でデプロイできる場合でも、zbpackがサポートしていない場合は、[GitHub](https://github.com/zeabur/zbpack)でIssueまたはPull Requestを提出してください。
</Callout>

Zeaburにデプロイされたサービスについては、サービス詳細ページの右上隅に、現在サーバーレス方式か、コンテナ化(Containerized)方式でのデプロイを確認できます：

![サービス詳細ページ](/advanced/serverless.png)

## インクリメンタルな静的生成（ISR）

サーバーレス方式のデプロイの利点を最大限に活用するために、Zeaburは「インクリメンタルな静的生成」(ISR、Incremental Static Regeneration)の機能をサポートしています。この機能により、ページは静的リソースとサーバーレス関数の両方であることが可能になります。ユーザーがウェブサイトを開くと、静的リソースから非常に高速にページの内容を表示できますが、この時、Zeaburはバックグラウンドでサーバーレス関数を再要求して結果を静的リソースに更新し、次回のアクセスのために準備します。

これにより、ユーザーはエクスペリエンスに影響を与えることなく、サーバーレスデプロイ方式の利点を享受できるだけでなく、ウェブサイトのSEOにも大きな助けとなります。

特定のサーバーレス関数でISR機能を有効にするには、出力結果の`.func`フォルダ隣に同じ名前の`.prerender-config.json`を追加すればよいです：

```json
{
  "expiration": "1h"
}
```

ここで`expiration`は任意のプロパティであり、Zeaburのサーバーレス関数がページを再レンダリングする間隔を設定します。